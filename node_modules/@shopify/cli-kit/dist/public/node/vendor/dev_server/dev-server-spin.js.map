{"version":3,"file":"dev-server-spin.js","sourceRoot":"","sources":["../../../../../src/public/node/vendor/dev_server/dev-server-spin.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,SAAS,CAAA;AAGxB,OAAO,EAAC,2BAA2B,EAAC,MAAM,UAAU,CAAA;AAEpD,MAAM,UAAU,YAAY,CAAC,WAAmB;IAC9C,OAAO;QACL,IAAI,EAAE,CAAC,UAAuB,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC;QAC/D,GAAG,EAAE,CAAC,UAAuB,EAAE,EAAE,EAAE,CAAC,GAAG,CAAC,WAAW,EAAE,OAAO,CAAC;KAC9D,CAAA;AACH,CAAC;AAED,SAAS,IAAI,CAAC,WAAmB,EAAE,EAAC,qBAAqB,KAAiB,EAAE;IAC1E,2BAA2B,EAAE,CAAA;IAE7B,MAAM,QAAQ,GAAG,EAAE,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,WAAW,EAAE,CAAC,CAAC,CAAA;IAClG,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC1B,MAAM,IAAI,KAAK,CAAC,kBAAkB,WAAW,wCAAwC,CAAC,CAAA;IACxF,CAAC;IAED,kEAAkE;IAClE,IAAI,WAAW,KAAK,SAAS,EAAE,CAAC;QAC9B,MAAM,MAAM,GAAG,qBAAqB,EAAE,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAA;QAEpE,OAAO,GAAG,MAAM,IAAI,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAA;IAC5D,CAAC;IAED,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,QAAQ,WAAW,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAA;IACnE,MAAM,YAAY,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA;IAC1C,MAAM,UAAU,GAAG,YAAY,KAAK,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,YAAY,EAAE,CAAA;IAExE,OAAO,GAAG,UAAU,GAAG,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAA;AAC/D,CAAC;AAED,SAAS,GAAG,CAAC,WAAmB,EAAE,UAAuB,EAAE;IACzD,OAAO,WAAW,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,EAAE,CAAA;AAChD,CAAC","sourcesContent":["import fs from 'node:fs'\n\nimport type {HostOptions} from './types.js'\nimport {assertCompatibleEnvironment} from './env.js'\n\nexport function createServer(projectName: string) {\n  return {\n    host: (options: HostOptions = {}) => host(projectName, options),\n    url: (options: HostOptions = {}) => url(projectName, options),\n  }\n}\n\nfunction host(projectName: string, {nonstandardHostPrefix}: HostOptions = {}): string {\n  assertCompatibleEnvironment()\n\n  const services = fs.readdirSync('/run/ports2').filter((file) => file.endsWith(`--${projectName}`))\n  if (services.length === 0) {\n    throw new Error(`DevServer for '${projectName}' not present in this spin environment`)\n  }\n\n  // Spin mostly doesn't do alternative hostname prefixing for core.\n  if (projectName === 'shopify') {\n    const prefix = nonstandardHostPrefix?.replace(/[-_]dev[-_]api$/, '')\n\n    return `${prefix}.${projectName}.${process.env.SPIN_FQDN}`\n  }\n\n  const match = new RegExp(`^(.+)${projectName}$`).exec(services[0]!)\n  const organization = match ? match[1] : ''\n  const spinPrefix = organization === 'shopify--' ? '' : `${organization}`\n\n  return `${spinPrefix}${projectName}.${process.env.SPIN_FQDN}`\n}\n\nfunction url(projectName: string, options: HostOptions = {}) {\n  return `https://${host(projectName, options)}`\n}\n"]}